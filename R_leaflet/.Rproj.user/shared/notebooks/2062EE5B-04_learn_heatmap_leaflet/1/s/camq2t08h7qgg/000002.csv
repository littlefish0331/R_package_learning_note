"0","library(jsonlite)"
"0",""
"0","# From http://data.okfn.org/data/datasets/geo-boundaries-world-110m"
"0","geojson <- readLines(""../data/countries.geojson"", warn = FALSE) %>%"
"0","  paste(collapse = ""\n"") %>%"
"0","  fromJSON(simplifyVector = FALSE)"
"0",""
"0","# Default styles for all features"
"0","geojson$style = list("
"0","  weight = 1,"
"0","  color = ""#555555"","
"0","  opacity = 1,"
"0","  fillOpacity = 0.8"
"0",")"
"0",""
"0","# Gather GDP estimate from all countries"
"0","gdp_md_est <- sapply(geojson$features, function(feat) {"
"0","  feat$properties$gdp_md_est"
"0","})"
"0","# Gather population estimate from all countries"
"0","pop_est <- sapply(geojson$features, function(feat) {"
"0","  max(1, feat$properties$pop_est)"
"0","})"
"0",""
"0","# Color by per-capita GDP using quantiles"
"0","pal <- colorQuantile(""Greens"", gdp_md_est/pop_est)"
"0","# Add a properties$style list to each feature"
"0","geojson$features <- lapply(geojson$features, function(feat) {"
"0","  feat$properties$style <- list("
"0","    fillColor = pal("
"0","      feat$properties$gdp_md_est / max(1, feat$properties$pop_est)"
"0","    )"
"0","  )"
"0","  feat"
"0","})"
"0",""
"0","# Add the now-styled GeoJSON object to the map"
"0","leaflet() %>% addGeoJSON(geojson)"
